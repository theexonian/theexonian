(function(){window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){setTimeout(e,16)}})(),jQuery.extend(jQuery.easing,{def:"ease-in-out",swing:function(e,t,n,r,i){return jQuery.easing[jQuery.easing.def](e,t,n,r,i)},"ease-in":function(e,t,n,r,i){return r*(t/=i)*t+n},"ease-out":function(e,t,n,r,i){return-r*(t/=i)*(t-2)+n},"ease-in-out":function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t+n:-r/2*(--t*(t-2)-1)+n}});var Pulse=function(){var P={};with(this){var _ns={},_handles="fullscreen item itemnext contentclick contentmouseover contentmousemove contentmouseout dataloaded hasloaded waiting transition transitionstart transitionend playing built playbacktimer resizecomplete ended start ready videobegin videoend",_id,_bind=function(e){var t=this;if(_handles.indexOf(e.type)<0)return;this.contentContainer.bind(e.type,function(n,r){typeof r=="boolean"||r instanceof Array?n=r:n=$.extend({},n,r);if(e.type==t.triggered){if(!e.fn)return;if(e.type==="transition")e.fn.call(t.container,{current:t.last,next:t.current,forward:t.forward},e.type);else if(e.type==="playing")e.fn.call(t.container,t.state==="playing"?!0:!1,e.type);else{if(n.nodeType&&e.type==="transitionend")return;e.fn.call(t.container,n.nodeType?$(n):n,e.type)}}})},_queue=function(e){e=e||!1;var t=[],n=this;return{add:function(e){return t.push(e),this},load:function(){var r=t.length;for(var i=0;i<r;i++){var s=t[i],o=s.priority||n.loadQueue.internal.length;delete s.priority,e?(s.node.bind("load",function(){_popQueue.call(n)}),n.loadQueue.external.push(s)):o===1?n.loadQueue.internal.unshift(s):n.loadQueue.internal.splice(o,0,s)}t=[],_popQueue.call(n)}}},_popQueue=function(){var e=this.loadQueue.internal.shift();if(!e){if(!this.loadQueue.canLoadExternal)return;e=this.loadQueue.external.shift()}e?e.node?e.node.attr("src",e.src):_popQueue.call(this):(clearInterval(this.loadQueue.interval),this.loadQueue.interval=!1)},_hasLoaded=function(e){var t=e.parent("div.pulse-content-container"),n;t.length&&t.data("asset")&&(n=t.data("asset").index),e.addClass("loaded"),n===this.options.index&&t.parent("div").css("opacity")==0&&(this.contentContainer.trigger(this.triggered="waiting",[!1]),_display.call(this)),this.contentContainer.trigger(this.triggered="hasloaded"),_popQueue.call(this)},_loadItemById=function(e){_pause.call(this);var t=this.idMap[e];t<this.options.index?t=-(this.options.index-t):t-=this.options.index,_update.call(this,t)},_get=function(e){return this.contentContainer.find('div[data-pulse-container="'+e+'"]')},_pause=function(){this.state="paused",clearTimeout(this.playTimer.id),this.contentContainer.trigger(this.triggered="playing")},_play=function(){this.state="playing",_update.call(this,1),this.contentContainer.trigger(this.triggered="playing")},_toggle=function(e,t){this.firstTime=!1,this.state=="playing"?_pause.call(this):_play.call(this)},_toggleFullScreen=function(){var e=Pulse.fullScreenApi;if(e.isFullScreen())this.lastHeight&&this.contentContainer.css("height",this.lastHeight),e.cancelFullScreen(),this.contentContainer.trigger(this.triggered="fullscreen",[!1]);else{this.lastHeight=this.contentContainer.css("height");var t=this.container.children(":not(.pulse-main-container)").height();this.contentContainer.css("height","-webkit-calc(100% - "+t+"px)"),this.contentContainer.css("height","-moz-calc(100% - "+t+"px)"),this.contentContainer.css("height","-ms-calc(100% - "+t+"px)"),this.contentContainer.css("height","-o-calc(100% - "+t+"px)"),this.contentContainer.css("height","calc(100% - "+t+"px)"),e.requestFullScreen(this.options.fullScreenRoot[0]),this.contentContainer.trigger(this.triggered="fullscreen",[!0])}},_startPlaybackTimer=function(){if(typeof this.firstTime=="undefined"&&!this.options.autostart){this.firstTime=!1;return}if(this.state==="playing"){var e=this,t=+(new Date),n={total:this.options.speed};this.playTimer.remaining=this.playTimer.remaining||this.options.speed,clearInterval(this.playTimer.id),this.playTimer.id=setInterval(function(){var r=+(new Date);e.playTimer.remaining-=r-t,t=r,n.remaining=Math.max(e.playTimer.remaining,0),n.totalItems=e.totalItems,e.contentContainer.trigger(e.triggered="playbacktimer",n),e.playTimer.remaining<=0&&_update.call(e,1)},50)}},_exists=function(e){var t=$.inArray(e,this.handlers);return t===-1?!1:this.handlers[t]},_loadPreset=function(e,t){t=t||!1;var n={width:e.width(),height:e.height()},r=!1,i=e.data("asset"),s={},o=e.find("img"),u=Math.max(Math.abs(this.options.index-i.index),1),a;e.removeClass("loaded");for(var f in i.presets){a=i.presets[f];if(a.width>n.width&&a.height>n.height){r=window.$K&&$K.isRetina()?a.hidpi_url:a.url,s.width=a.width,s.height=a.height;break}}r||(r=$K.isRetina()?a.hidpi_url:a.url),e.data("size",s);var l={node:o,src:r,priority:u};if(!t)return l;_queue.call(this).add(l).load()},_load=function(){var e=[this.loaded[this.options.index].id],t=this,n,r;for(i=1;i<=this.cushion;i++)n=this.options.index-i,n<0&&(n=this.loaded.length+n),this.loaded[n]&&(_get.call(this,this.loaded[n].id).length<=0&&this.contentContainer.append(_build.call(this,n)),e.push(this.loaded[n].id));_get.call(this,this.loaded[this.options.index].id).length<=0&&this.contentContainer.append(_build.call(this,this.options.index));for(i=1;i<=this.cushion;i++)r=this.options.index+i,r>=this.loaded.length&&(r-=this.loaded.length),this.loaded[r]&&(_get.call(this,this.loaded[r].id).length<=0&&this.contentContainer.append(_build.call(this,r)),e.push(this.loaded[r].id));var s=_queue.call(this);this.contentContainer.find("div.pulse-content-container").each(function(){var n=$(this),r=n.find("img"),i=n.data("asset"),o=n.parent(),u=i&&i.id;$.inArray(u,e)===-1?(r.attr("src",""),o.remove()):r.hasClass("loaded")||s.add(_loadPreset.call(t,n))}),s.load()},_ratio=function(e,t){return t&&(this.realDims={width:e.parents("div").width(),height:e.parents("div").height()},e=e.data("asset")),this.containerRatio=this.containerRatio||this.realDims.width/this.realDims.height,e.aspect_ratio>=this.containerRatio?{w:this.realDims.width,h:Math.round(this.realDims.width/e.aspect_ratio)}:{w:Math.round(this.realDims.height*e.aspect_ratio),h:this.realDims.height}},_kill=function(){this.dead=!0,this.contentContainer.off(),this.state="paused",clearInterval(this.loadQueue.interval),clearTimeout(this.playTimer.id),delete _ns[this.container.attr("id")]},_update=function(e){if(this.transitioning)return;var t=parseInt(this.options.index,10)+e;clearInterval(this.playTimer.id),this.playTimer.remaining=!1,e<0?(_pause.call(this),this.forward=!1):this.forward=!0;if(this.loaded.length<=1||this.options&&typeof this.options.loop!="undefined"&&this.options.loop===!1&&t>=this.loaded.length){this.contentContainer.trigger(this.triggered="ended");return}this.options.index=t<0?this.loaded.length-1:t>=this.loaded.length?0:t;var n=_get.call(this,this.loaded[this.options.index].id);n.length?n.find("img").hasClass("loaded")?_display.call(this):_loadPreset.call(this,n.find("div.pulse-content-container"),!0):(this.contentContainer.trigger(this.triggered="waiting",[!0]),n=_build.call(this,this.options.index),this.contentContainer.append(n),_loadPreset.call(this,n.find("div.pulse-content-container"),!0))},_getItem=function(){return this.currentData},_getNextItem=function(){var e=this.options.index+1;return e>=this.loaded.length&&this.options.loop===!0&&(e=0),this.loaded[e]||!1},_display=function(){var e=this;this.transitioning=!0,this.current&&this.current.css("z-index",9),this.currentData=this.loaded[this.options.index],this.current=_get.call(this,this.currentData.id),this.current.css("z-index",10),this.last?(this.last.find(".video-container").css({left:-1e4}),this.last.find("img").show()):this.options.autostart===!0&&(this.state="playing",this.contentContainer.trigger(this.triggered="playing")),this.contentContainer.trigger(this.triggered="transitionstart",{dom:this.current,data:this.currentData}),this.contentContainer.trigger(this.triggered="itemnext",{dom:this.current,data:this.currentData});if(this.options.next&&!this.options.loop){var t=$(this.options.next);t.length&&(this.currentData.is_last?t.addClass("k-pulse-button-disabled"):t.removeClass("k-pulse-button-disabled"))}if(this.options.previous&&!this.options.loop){var n=$(this.options.previous);n.length&&(this.currentData.is_first?n.addClass("k-pulse-button-disabled"):n.removeClass("k-pulse-button-disabled"))}this.loadQueue.canLoadExternal=!0,this.contentContainer.trigger(this.triggered="transition",this.current),this.last=this.current},_build=function(e){var t=this.loaded[e],n=$('<div data-pulse-container="'+t.id+'" />'),r=$("<div />"),i=$("<img />"),s=this,o,u;t.index=e,t.position=e+1,t.total=this.totalItems,t.is_first=t.position===1,t.is_last=t.position===this.totalItems,n.css({position:"absolute",background:this.options.background,width:"100%",height:"100%",top:0,left:0,right:"auto",bottom:"auto",opacity:0,margin:0,padding:0,border:0,overflow:"hidden",zIndex:9});var a=_position.call(this,t);r.addClass("pulse-content-container").css({position:"absolute",width:a.width,height:a.height,left:a.left,top:a.top}).data("asset",t),i.attr({alt:t.title||t.filename,width:"100%",height:"100%"}).css({position:"absolute",top:0,left:0}).one("load",function(){_hasLoaded.call(s,$(this))}),r.append(i);if(t.file_type==="video"){r.append($("<div/>").addClass("mejs-overlay-button").css({cursor:"pointer"}).bind("mousedown",function(e){e.preventDefault(),e.stopPropagation();var o=r.find(".video-container"),u=o.find("video")[0].player;u.setCurrentTime(0),u.play(),o.css("left",0),i.hide(),o.data("resume",s.state==="playing"),_pause.call(s),s.contentContainer.trigger(s.triggered="videobegin"),_crop.call(s,t.aspect_ratio)&&r.find(".mejs-controls").css({width:n.width(),left:Math.abs(s.realDims.width/2-n.find(".pulse-content-container").width()/2)})}));var f=$("<video/>").css({position:"absolute",top:0,left:0,width:"100%",height:"100%"}).attr({width:"100%",height:"100%",src:t.original.url}),l=$("<div/>").addClass("video-container").css({position:"absolute",top:0,left:-1e4,width:"100%",height:"100%"});l.append(f),r.append(l),requestAnimationFrame(function(){var e=$(f).mediaelementplayer({success:function(e){e.addEventListener("ended",function(){s.current.find(".video-container").data("resume")&&(_update.call(s,1),s.state="playing"),s.contentContainer.trigger(s.triggered="videoend")})}})})}return n.append(r),this.contentContainer.trigger(this.triggered="built",{dom:n,data:t}),n},_data=function(e){e=e||!1;var t=function(e){if(!e.content){if(!e.covers)return;e.content=e.covers}this.options.index>e.total-1&&(this.options.index=0),this.options.order==="random"&&e.content.sort(function(){return.5-Math.random()});if(e.total===0){this.contentContainer.trigger(this.triggered="dataloaded",{items:!1,source:e.site_link||!1}),this.options.fallbackText?this.container.html('<span class="k-note">'+this.options.fallbackText+"</span>"):this.options.fallbackElement&&(this.container.hide(),this.options.fallbackElement.show());return}var t=!1,n=!1;this.totalItems===0&&(this.options.link_to==="album"&&e.album&&(this.options.link_to=e.album.__koken_url),this.options.dataUrl.match(/limit:[0-9]+/)?(n=!0,this.totalItems=e.content.count):this.totalItems=e.total,this.cushion=Math.max(this.totalItems<this.cushion*2+1?Math.floor((this.totalItems-.5)/2):this.cushion,1),t=!0);var r,i;for(r=0,i=e.content.length;r<i;r++)e.content[r].presets&&(this.loaded.push(e.content[r]),this.idMap[e.content[r].id]=this.loaded.length-1);if(this.options.size==="auto"){var s=0,o=0;$.each(e.content,function(e,t){if(isNaN(t.aspect_ratio))return;s+=t.aspect_ratio,o++});var u=s/o,a,f=Infinity,l=["1:10","2:10","3:10","4:10","5:10","6:10","7:10","8:10","9:10","10:10","10:9","10:8","10:7","10:6","10:5","10:4","10:3","10:2","10:1","4:3","3:4","3:2","2:3","1:1","16:9"];$.each(l,function(e,t){var n=t.split(":"),r=n[0]/n[1],i=Math.abs(u-r);i<f&&(a=t,f=i)}),this.options.size=a,_setSize.call(this),_resize.call(this)}this.contentContainer.trigger(this.triggered="dataloaded",{items:e.content,source:e.site_link||!1}),t&&(this.options.album_type=e.album?e.album.album_type:e.album_type?e.album_type:!1,this.options.album_id=e.album?e.album.id:e.id?e.id:!1,this.contentContainer.trigger(this.triggered="waiting",[!0]),_load.call(this),this.contentContainer.trigger(this.triggered="ready",this.container)),e.page<e.pages&&!n&&(this.options.dataUrl=this.options.dataUrl.replace(/\/page:[0-9]+/,"")+"/page:"+(e.page+1),_data.call(this))};if(e)t.call(this,e);else{var n=this;$.ajax({url:this.options.dataUrl,dataType:"json",success:function(e){t.call(n,e)}})}},_event=function(e,t,n,r){var i=this;$(document).on(t,e,{},function(e){this.forward=r<0?!1:!0,n.call(i,r,e),e.preventDefault()})},_resizePresets=function(){var e=_queue.call(this),t=this;this.contentContainer.find("div.pulse-content-container").each(function(){var n=$(this),r=n.data("size");typeof r=="object"&&(t.realDims.width>r.width||t.realDims.height>r.height)&&e.add(_loadPreset.call(t,n))}),e.load()},_position=function(e){var t,n,r,i;if(_crop.call(this,e.aspect_ratio))r=this.realDims.width,i=Math.round(r/e.aspect_ratio),i<this.realDims.height&&(i=this.realDims.height,r=Math.round(i*e.aspect_ratio)),n=Math.min(0,Math.max(-(r-this.realDims.width),this.realDims.width/2-r/(100/e.focal_point.x))),t=Math.min(0,Math.max(-(i-this.realDims.height),this.realDims.height/2-i/(100/e.focal_point.y)));else{var s=_ratio.call(this,e);r=s.w,i=s.h,n=this.realDims.width/2-r/2,t=this.realDims.height/2-i/2}return{width:r,height:i,left:n,top:t}},_crop=function(e){var t=e<1,n=this.containerRatio<1;return this.options.crop==="fill"||this.options.crop==="adaptive"&&t===n||this.options.crop==="portrait"&&t||this.options.crop==="landscape"&&!t},_resize=function(){if(this.dead)return;var e=this;this.options.autoHeight&&this.contentContainer.css({height:this.container.width()*this.options.autoHeight}),this.realDims={width:this.contentContainer.width(),height:this.contentContainer.height()};if(this.realDims.width===0&&Pulse.fullScreenApi.isFullScreen()){this.options.fullScreenRoot.css("width","100%"),_resize.call(this);return}this.containerRatio=this.realDims.width/this.realDims.height;if(this.options.width.toString().indexOf("%")!==-1||this.options.height.toString().indexOf("%")!==-1)window.clearTimeout(this.resizeInterval),this.resizeInterval=window.setTimeout(function(){_resizePresets.call(e)},500);this.contentContainer.find("div.pulse-content-container").each(function(){var t=$(this);if(!t.data("asset"))return;var n=_position.call(e,t.data("asset"));t.css({width:n.width,height:n.height,left:n.left,top:n.top});var r=t.find("video");r.length&&(r=r[0].player,r.setPlayerSize(n.width,n.height),r.setControlsSize(),r.pluginType!=="native"&&r.media.setVideoSize&&r.media.setVideoSize(n.width,n.height),_crop.call(e,t.data("asset").aspect_ratio)&&t.find(".mejs-controls").css({width:e.realDims.width,left:Math.abs(l)}))})},_clone=function(e){if(!e)return!1;var t=$(e[0].cloneNode(!0));return t.find("[data-node-uid]").removeAttr("data-node-uid"),t},_setSize=function(){this.options.width="100%";var e=this.options.size==="auto"?"3:2":this.options.size,t=e.split(":");this.options.height=t[1]+"/"+t[0];var n=this.options.height.split("/"),r=n[0]/n[1],i;return isNaN(this.options.width)?i=this.container.parent().width()*r:i=this.options.width*r,this.options.autoHeight=r,i},_setup=function(e,t){var n=$(e);_id=n.attr("id"),_ns[_id]={},_ns[_id].context=n,_ns[_id].container=n,_ns[_id].dead=!1,_ns[_id].parent=n.parent(),_ns[_id].platform=window.onorientationchange?4:10,_ns[_id].handlers=[],_ns[_id].loaded=[],_ns[_id].triggers=[],_ns[_id].touch={},_ns[_id].playTimer={id:0,remaining:!1},_ns[_id].cushion=3,_ns[_id].realDims={},_ns[_id].forward=!0,_ns[_id].transitioning=!1,_ns[_id].touch={},_ns[_id].totalItems=0,_ns[_id].idMap={},_ns[_id].loadQueue={internal:[],external:[],canLoadExternal:!1,interval:!1},_ns[_id].stack=0,_ns[_id].fsElWidth=0,_ns[_id].options={},_ns[_id].options.album_id=!1,_ns[_id].options.album_type=!1,_ns[_id].options.width=t&&t.width?t.width:"100%",_ns[_id].options.width=t&&t.width?t.width:"100%",_ns[_id].options.height=t&&t.height?t.height:!1,_ns[_id].options.background=t&&t.background||_ns[_id].container.css("background"),_ns[_id].options.speed=(t&&t.speed||5)*1e3,_ns[_id].options.index=t&&t.index||0,_ns[_id].options.crop=t&&t.crop||"none",_ns[_id].options.dataUrl=t&&t.dataUrl||"/api.php?/content",_ns[_id].options.autoHeight=!1,_ns[_id].options.size=t&&t.size&&(t.size==="auto"||t.size.indexOf(":")>0)&&t.size||!1,_ns[_id].options.allowFullScreen=t&&t.hasOwnProperty("allowfullscreen")?t.allowfullscreen:!0,_ns[_id].options.fullScreenRoot=t&&t.fullscreenroot&&$(t.fullscreenroot)||_ns[_id].container,_ns[_id].options.fallbackText=t&&t.fallbacktext||!1,_ns[_id].options.fallbackElement=t&&t.fallbackelement?$(t.fallbackelement):!1,_ns[_id].options.link_to=t&&t.link_to!=="false"&&t.link_to,_ns[_id].options.transition_duration=t&&parseInt(t.transition_duration,10)||500,_ns[_id].options.data=t.data||!1,_ns[_id].options.order=t&&t.random===!0?"random":"default",_ns[_id].options.album_url=t.albumUrl||!1,_ns[_id].options.link_to&&$.inArray(t.link_to,["lightbox","content","album"])!==-1&&!window.$K&&(_ns[_id].options.link_to=!1),!_ns[_id].options.size&&!_ns[_id].options.height&&(_ns[_id].options.size="3:2");var r=_ns[_id].options.height;return _ns[_id].options.size&&(r=_setSize.call(_ns[_id])),t&&(t.transition_type?_ns[_id].options.transition=t.transition_type:_ns[_id].options.transition="dissolve",typeof t.loop=="undefined"?_ns[_id].options.loop=!0:_ns[_id].options.loop=t.loop,_ns[_id].options.autostart=typeof t.autostart=="undefined"?!0:t.autostart,t.next&&_event.call(_ns[_id],t.next,"click",function(){(this.options.loop||!this.currentData.is_last)&&_update.call(this,1)}),t.previous&&_event.call(_ns[_id],t.previous,"click",function(){(this.options.loop||!this.currentData.is_first)&&_update.call(this,-1)}),t.toggle&&_event.call(_ns[_id],t.toggle,"click",_toggle),t.play&&_event.call(_ns[_id],t.play,"click",_play),t.pause&&_event.call(_ns[_id],t.pause,"click",_pause),t.pause&&_event.call(_ns[_id],t.pause,"click",_pause),t.fullscreen&&(Pulse.fullScreenApi.supportsFullScreen?_event.call(_ns[_id],t.fullscreen,"click",_toggleFullScreen):$(t.fullscreen).addClass("k-pulse-button-disabled"))),_ns[_id].container.css({background:_ns[_id].options.background,position:"relative",width:"100%"}),String(r).indexOf("%")!==-1&&_ns[_id].container.css("height",r),_ns[_id].contentContainer=$("<div/>").css({width:_ns[_id].options.width,height:r,position:"relative"}).attr("class","pulse-main-container"),_ns[_id].options.link_to&&_ns[_id].contentContainer.css("cursor","pointer"),_ns[_id].contentContainer.bind("click mousedown mouseover mousemove mouseout touchstart touchmove touchend",function(e){if(e.type==="mousedown"){if($.inArray(e.target.tagName.toLowerCase(),["embed","object","video"])===-1)return;e.type="click"}if($(e.target).closest(".pulse-content-container").closest(".pulse-main-container").parent().length<=0)return;var t=_ns[$(e.target).closest(".pulse-content-container").closest(".pulse-main-container").parent().attr("id")],n=_exists.call(t,"content"+e.type);if(n){var r={dom:t.current,data:t.currentData};if(e.type.indexOf("touch")===-1){var i=t.contentContainer.offset(),s=e.pageX-i.left,o=i.top-e.pageY;r.cursor={percentageX:Math.abs(Math.round((s/t.contentContainer.width()).toFixed(2)*100)),percentageY:Math.abs(Math.round((o/t.contentContainer.height()).toFixed(2)*100))}}t.contentContainer.trigger(t.triggered="content"+e.type,r)}e.changedTouches&&e.type!="click"&&(e.type==="touchstart"&&(t.touch.startx=e.changedTouches[0].pageX),e.type==="touchmove"&&(t.touch.startx<=e.changedTouches[0].pageX?t.touch.action=1:t.touch.action=-1),e.type==="touchend"&&(_update.call(t,t.touch.action),t.touch={}));if(e.type==="click"&&t.options.link_to){var u=t.options.dataUrl,a=!1,f=window.$K?window.$K.location.defaults:!1,l;t.options.data&&t.options.data.album_id?a=t.options.data.album_id:t.options.album_id&&(a=t.options.album_id);switch(t.options.link_to){case"advance":_update.call(t,1);return;case"playback":_toggle.call(t);return;case"lightbox":l=t.currentData.__koken_url?t.currentData.__koken_url+"lightbox":!1;break;case"content":l=t.currentData.__koken_url;break;case"album":var c=RegExp(t.options.album_url.replace(/:[a-z_]+/,"[^/]+"));t.currentData.__koken_url&&c.test(t.currentData.__koken_url)?l=t.currentData.__koken_url.match(c)[0]:l=!1;break;default:l=t.options.link_to}if(l){var h=location.href.match(/&preview=.*/)||"";location.href=(l.indexOf("http://")===-1?window.$K.location.root:"")+l+(l.indexOf("http://")===-1?h:"")}}}),_ns[_id].container.append(_ns[_id].contentContainer),_ns[_id].realDims={width:_ns[_id].contentContainer.width(),height:_ns[_id].contentContainer.height()},$(window).bind("resize webkitfullscreenchange mozfullscreenchange fullscreenchange",function(e){if(!_ns.all||_ns.all.length<$(".pulse-main-container").length)_ns.all=[],$(".pulse-main-container").each(function(e,t){_ns.all.push(_ns[$(t).parent().attr("id")])});for(var t=0,n=_ns.all.length;t<n;t++){var r=_ns.all[t],i;i&&clearTimeout(i);if(!r)return;i=setTimeout(function(){r.contentContainer.trigger(r.triggered="resizecomplete")},200),_resize.call(r)}}).trigger("resize"),_ns[_id].triggers={},_ns[_id].triggers.play=function(){_play.call(this)},_ns[_id].triggers.pause=function(){_pause.call(this)},_ns[_id].triggers.toggle=function(){_toggle.call(this)},_ns[_id].triggers.toggleFullScreen=function(){_toggleFullScreen.call(this)},_ns[_id].triggers.transitionEnd=function(){this.transitioning=!1,_load.call(this),_startPlaybackTimer.call(this),this.contentContainer.trigger(this.triggered="transitionend",{dom:this.current,data:this.currentData}),this.contentContainer.trigger(this.triggered="item",{dom:this.current,data:this.currentData})},t&&$.each(t,function(e,t){_ns[_id].options.hasOwnProperty(e)||(_ns[_id].options[e]=t)}),_ns[_id]};P.init=function(e,t){var n=_setup(e,t),r={context:n.context,options:$.extend({},n.options),on:function(e,t){var r=[];return $.each(e.split(" "),function(e,t){RegExp("^|\\s"+t+"\\s|$").test(_handles)&&r.push(t)}),r.length&&$.each(r,function(e,r){n.handlers.push(r),_bind.call(n,{type:r,fn:t})}),this},off:function(e){n.container.unlisten(e)},kill:function(){_kill.call(n)},play:function(){_play.call(n)},pause:function(){_pause.call(n)},next:function(){_update.call(n,1)},previous:function(){_update.call(n,-1)},toggle:function(){_toggle.call(n)},toggleFullscreen:function(){Pulse.fullScreenApi.supportsFullScreen&&_toggleFullScreen.call(n)},loadItem:function(e){_loadItemById.call(n,e)},getItem:function(){return _getItem.call(n)},getNextItem:function(){return _getNextItem.call(n)},trigger:function(e){if(n.dead)return;return n.triggers[e]?n.triggers[e].call(n):n.contentContainer.trigger(n.triggered=e,n.contentContainer),this},ratio:function(e){return _ratio.call(n,e,!0)},append:function(e){e.css("position").length<=0&&e.css("position","relative"),e.css("zIndex",12),this.context.find(".pulse-main-container").append(e)},queue:function(){return _queue.call(n,!0)},clone:function(e){return _clone.call(n,e)}};Pulse.transitions[n.options.transition]?Pulse.transitions[n.options.transition].call(r,n.options):Pulse.transitions.dissolve.call(r,n.options);for(var i in window.Pulse.plugin)r[i]=window.Pulse.plugin[i];return $(function(){n.contentContainer.trigger(n.triggered="start",n.container);if(n.options.data&&n.options.data.content){var e={content:n.options.data.content,total:n.options.data.content.length,page:1,pages:1};_data.call(n,e)}else _data.call(n)}),r}}return P.init}.call({});window.Pulse.plugin={},window.Pulse.transitions={none:function(e){var t=this;this.on("transition",function(e){e.current&&e.current.css({opacity:0}),e.next.css({opacity:1}),t.trigger("transitionEnd")})},dissolve:function(e){var t=this;this.on("transition",function(n){n.current&&n.current.animate({opacity:0},{duration:e.transition_duration}),n.next.animate({opacity:1},{duration:e.transition_duration,complete:function(){t.trigger("transitionEnd")}})})},fade:function(e){var t=this;this.on("transition",function(n){n.current?n.current.animate({opacity:0},{duration:e.transition_duration/2,complete:function(){n.next.animate({opacity:1},{duration:e.transition_duration/2,complete:function(){t.trigger("transitionEnd")}})}}):n.next.animate({opacity:1},{duration:e.transition_duration,complete:function(){t.trigger("transitionEnd")}})})},slide:function(e){var t=this;this.on("transition",function(n){var r=t.context,i=t.clone(n.next),s=t.clone(n.current),o=r.width(),u=!1,a=$("<div/>").css({width:"100%",height:"100%",top:0,left:0,position:"absolute",overflow:"hidden"}),f=$("<div/>").css({width:o*2,height:"100%",top:0,left:n.forward?0:"-"+o+"px",position:"relative"}).appendTo(a),l=function(){n.next.css({opacity:1}),a.remove(),t.trigger("transitionEnd")},c=["Webkit","Moz","O","ms",""],h=!1;c.forEach(function(e,t){if(e+"Transform"in document.body.style)return h=e,!1}),h&&(h.length&&(h="-"+h.toLowerCase()+"-"),f.css(h+"transition",h+"transform "+e.transition_duration+"ms"),u=!0),s&&(n.forward||s.css({left:o+"px"}),f.append(s)),i.css({opacity:1}),n.forward&&i.css({left:o+"px"}),f.append(i),t.append(a),window.setTimeout(function(){if(!n.current){l();return}t.options.crop!=="fill"&&n.current.css({opacity:0}),requestAnimationFrame(function(){o=n.forward?"-"+o:o,u?(f.bind("webkitTransitionEnd mozTransitionEnd msTransitionEnd oTransitionEnd transitionend",l),f.css(h+"transform","translate3d("+o+"px,0,0)")):f.animate({left:o},{duration:e.transition_duration,complete:l})})},n.current?50:250)})}},window.Pulse.register_transition=function(e){window.Pulse.transitions=$.extend(window.Pulse.transitions,e)},function(){var e={supportsFullScreen:!1,isFullScreen:function(){return!1},requestFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",prefix:""},t="webkit moz o ms khtml".split(" ");if(typeof document.cancelFullScreen!="undefined")e.supportsFullScreen=!0;else for(var n=0,r=t.length;n<r;n++){e.prefix=t[n];if(typeof document[e.prefix+"CancelFullScreen"]!="undefined"){e.supportsFullScreen=!0;break}}e.supportsFullScreen&&(e.fullScreenEventName=e.prefix+"fullscreenchange",e.isFullScreen=function(){switch(this.prefix){case"":return document.fullScreen;case"webkit":return document.webkitIsFullScreen;default:return document[this.prefix+"FullScreen"]}},e.requestFullScreen=function(e){return this.prefix===""?e.requestFullScreen():e[this.prefix+"RequestFullScreen"]()},e.cancelFullScreen=function(e){return this.prefix===""?document.cancelFullScreen():document[this.prefix+"CancelFullScreen"]()}),Pulse.fullScreenApi=e}();